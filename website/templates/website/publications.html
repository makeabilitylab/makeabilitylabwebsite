{% extends "website/base.html" %}

{% block pagetitle %}Publications{% endblock %}

{% load static %}

{% block stylesheets %}
<link rel="stylesheet" href="{% static 'website/css/publications.css' %}">
<link rel="stylesheet" href="{% static 'website/css/jquery-ui.min.css' %}">
<link rel="stylesheet" href="{% static 'website/css/jquery-ui.theme.min.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">
{% endblock %}

{% block external_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.js"></script>
<script src="{% static 'website/js/jquery-ui.min.js' %}"></script>
<script src="{% static 'website/js/citationPopoverSimple.js' %}"></script>
{% endblock %}

{% block scripts %}
document.addEventListener('DOMContentLoaded', function() {
  CitationPopover.init('.publication-citation-link');
});
{% endblock %}

{% block maincarousel %}
<!-- No carousel on publications page -->
{% endblock %}

{% block content %}
<div id="publications-container" class="container" style="margin-top: 80px;">
  
  <div class="row row-flex">
    <div class="col-md-1 hidden-sm hidden-xs">
      <nav id="js-toc" class="js-toc toc" aria-label="Table of contents"></nav>
    </div>

    <div class="col-md-11">
      <div id="makelab-recent-publications" class="makelab-content-container">
        <h1 style="margin-top: 0;">Publications</h1>
        
        {% for pub_year, pub_list in map_year_to_pub_list.items %}
        <section aria-labelledby="year-{{ pub_year }}">
          <h2 id="year-{{ pub_year }}" class="heading-with-anchor">
            {{ pub_year }}
            <a href="#year-{{ pub_year }}" 
              class="header-anchor" 
              aria-label="Link to {{ pub_year }} publications">
              <i class="fa-solid fa-link" aria-hidden="true"></i>
            </a>
          </h2>
          
          {% for pub in pub_list %}
          <div class="row" style="margin-left: 5px;">
            <div class="col-xs-12">
              {% include "snippets/display_pub_snippet.html" with orientation="vertical" %}
            </div>
          </div>
          {% endfor %}
        </section>
        {% endfor %}
      </div>
    </div>
  </div> 
</div>

<script>
  // Initialize tocbot for year-based navigation
  tocbot.init({
    tocSelector: '.js-toc',
    contentSelector: '.makelab-content-container',
    headingSelector: 'h2',
    hasInnerContainers: true,
    
    // Disable Tocbot's built-in positioning. 
    // We want our CSS (position: sticky) to handle this exclusively.
    positionFixedSelector: null,
    fixedSidebarOffset: null,

    scrollSmoothOffset: -100,
    headingsOffset: 100
  });
</script>
{% endblock %}