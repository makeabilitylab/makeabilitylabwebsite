{% comment %}
================================================================================
VIDEO SNIPPET TEMPLATE
================================================================================

Reusable template for displaying a single video. Used on:
- Person profile pages
- Project pages
- Videos listing page

USAGE:
  {% include "snippets/display_video_snippet.html" %}

ACCESSIBILITY:
- Uses <article> semantic element
- iframe has required title attribute for screen readers
- Links have meaningful text or aria-labels
- Time-ago display uses <time> element with datetime attribute

CONTEXT VARIABLES:
- video: Video model instance (required)

DEPENDENCIES:
- design-tokens.css
- video-snippet.css (styles for .video-card)
- video-age.js (handles humanized time display)

NOTE ON VIDEO AGE:
  Previously used inline document.write() which is problematic.
  Now uses data attributes and a separate JS module (video-age.js)
  that runs on DOMContentLoaded to populate the time display.

@version 2.0.0 - Accessibility refactor, removed inline JS
================================================================================
{% endcomment %}

{% load static %}
{% load thumbnail %}
{% load cropping %}
{% load ml_tags %}

<article class="video-card">
  
  <!-- Video Player (iframe) -->
  <div class="video-player-container">
    <iframe class="video-player" 
            src="{{ video.get_embed }}" 
            title="Video: {{ video.title }}"
            frameborder="0" 
            allow="autoplay; fullscreen" 
            allowfullscreen
            loading="lazy">
    </iframe>
  </div>

  <!-- Video Info -->
  <div class="video-info">
    
    <!-- Title -->
    <h3 class="video-title">
      <a href="{{ video.video_url }}">
        <span class="line-clamp">{{ video.title }}</span>
      </a>
    </h3>

    <!-- Links & Metadata -->
    <div class="video-links">
      <a href="{{ video.video_url }}" 
         aria-label="Watch on {{ video.get_video_host_str }}">
        <i class="fa-solid fa-play" aria-hidden="true"></i>
        <span>{{ video.get_video_host_str }}</span>
      </a>

      {% if video.has_publication %}
      <a href="{{ MEDIA_URL }}{{ video.publication.pdf_file }}" 
         aria-label="Download related paper">
        <i class="fa-solid fa-file-lines" aria-hidden="true"></i>
        <span>Paper</span>
      </a>
      {% endif %}
      
      {% for project in video.projects.all %}
      {% if project.can_show_online %}
      <a href="{% url 'website:project' project.short_name %}" 
         aria-label="View project: {{ project.name }}">
        <i class="fa-solid fa-flask" aria-hidden="true"></i>
        <span>{{ project.name }}</span>
      </a>
      {% endif %}
      {% endfor %}

      <!-- Video Age/Date -->
      <span class="video-age" 
            data-video-age-ms="{{ video.get_age_in_ms }}"
            data-video-date="{{ video.date|date:'c' }}">
        <time datetime="{{ video.date|date:'c' }}">
          {{ video.date|date:"M d, Y" }}
        </time>
      </span>
    </div>
    
  </div>
</article>