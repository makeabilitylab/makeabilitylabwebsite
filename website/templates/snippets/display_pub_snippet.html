{% comment %}
================================================================================
PUBLICATION SNIPPET TEMPLATE
================================================================================

Reusable template for displaying a single publication. Supports two layouts:
- horizontal: Compact card for grids (index page, project pages)
- vertical: Detailed row for listings (publications page)

USAGE:
  {% include "snippets/display_pub_snippet.html" with orientation="horizontal" %}
  {% include "snippets/display_pub_snippet.html" with orientation="vertical" %}

ACCESSIBILITY:
- All images have descriptive alt text
- Icon-only elements have aria-hidden="true" (text labels provide context)
- Award images have meaningful alt text
- No deprecated HTML attributes (align, etc.)

CONTEXT VARIABLES:
- pub: Publication model instance (required)
- orientation: "horizontal" or "vertical" (optional, defaults to vertical)

@version 2.0.1 - Removed listing keywords from horizontal layout
@author Makeability Lab
================================================================================
{% endcomment %}

{% load static %}
{% load thumbnail %}
{% load cropping %}
{% load ml_tags %}

{% if pub and orientation == 'horizontal' %}
<!-- ======================== Horizontal Layout ======================== -->
<article class="col-xs-12 col-sm-6 col-md-4 pub-column-horiz-layout">
  
  <!-- Thumbnail with optional award banner -->
  <div class="pub-thumbnail pub-thumbnail-horiz-layout">
    <a href="{{ pub.pdf_file.url }}" class="pub-thumbnail-link">
      <img src="{% thumbnail pub.thumbnail 300x0 detail %}" 
           alt="Thumbnail for: {{ pub.title }}"
           class="pub-thumbnail-image2 img-responsive" 
           style="max-width: 100px;">
    </a>
    {% if pub.award %}
    <img src="{% static 'website/img/awardoverlay.png' %}" 
         alt="" 
         aria-hidden="true"
         class="pub-award-banner">
    {% endif %}
  </div>

  <!-- Title -->
  <a href="{{ pub.pdf_file.url }}">
    <!-- Making the titles h3s enables screen readers to find and present them more easily -->
    <h3 class="artifact-title line-clamp" style="margin-top: 0;">{{ pub.title }}</h3>
  </a>
  
  <!-- Venue and award info -->
  <p class="artifact-venue line-clamp-one-line">
    {{ pub.forum_name }} {{ pub.date|date:'Y' }}
    {% if pub.to_appear %}
    <span class="pub-to-appear-text">To Appear</span>
    {% endif %}
    {% if pub.award %}
    <span class="pub-award">
      | 
      {% if pub.is_best_paper %}
      <span class="pub-award-icon">
        <img src="{% static 'website/img/bestpaper.png' %}" 
             alt="Best Paper Award" 
             class="award-icon">
      </span>
      {% elif pub.is_honorable_mention %}
      <span class="pub-award-icon">
        <img src="{% static 'website/img/honorablemention.png' %}" 
             alt="Honorable Mention Award" 
             class="award-icon">
      </span>
      {% endif %}
      <span class="pub-award-text">{{ pub.award }}</span>
    </span>
    {% endif %}
  </p>
  
  <!-- Authors -->
  <p class="artifact-authors line-clamp3">
    {% for author in pub.authors.all %}
    <a href="{% url 'website:member_by_name' member_name=author.url_name %}">{{ author.get_full_name }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
  </p>

  <!-- Download links (shown on hover) -->
  {% if pub.pdf_file %}
  <p class="pub-download-links">
    <a href="{{ pub.pdf_file.url }}" aria-label="Download PDF of {{ pub.title }}">
      <i class="fa-solid fa-file-pdf" aria-hidden="true"></i>PDF
    </a>
    {% if pub.arxiv_url %}
    <a href="{{ pub.arxiv_url }}" aria-label="View on arXiv">
      <i class="ai ai-arxiv" aria-hidden="true"></i>arXiv
    </a>
    {% endif %}
    {% if pub.official_url %}
    <a href="{{ pub.official_url }}" aria-label="View DOI record">
      <i class="ai ai-doi" aria-hidden="true"></i>doi
    </a>
    {% endif %}
    {% include 'snippets/display_citation_link_snippet.html' %}
    {% if pub.code_repo_url %}
    <a href="{{ pub.code_repo_url }}" aria-label="View code repository">
      <i class="fa-brands fa-github" aria-hidden="true"></i>Code
    </a>
    {% endif %}
    {% if pub.talk and pub.talk.pdf_file %}
    <a href="{{ pub.talk.pdf_file.url }}" aria-label="Download talk slides">
      <i class="fa-solid fa-person-chalkboard" aria-hidden="true"></i>Talk
    </a>
    {% endif %}
    {% if pub.poster and pub.poster.pdf_file %}
    <a href="{{ pub.poster.pdf_file.url }}" aria-label="Download poster">
      <i class="fa-solid fa-image" aria-hidden="true"></i>Poster
    </a>
    {% endif %}
    {% for project in pub.projects.all %}
    {% if project.can_show_online %}
    <a href="{% url 'website:project' project.short_name %}" aria-label="View project: {{ project.name }}">
      <i class="fa-solid fa-flask" aria-hidden="true"></i>{{ project.name }}
    </a>
    {% endif %}
    {% endfor %}
  </p>
  {% endif %}
  
</article>

{% elif pub %}
<!-- ======================== Vertical Layout ======================== -->
<article class="row pub-row-vert-layout">
  
  <!-- Thumbnail with optional award banner -->
  <div class="pub-thumbnail">
    <a href="{{ pub.pdf_file.url }}" class="pub-thumbnail-link">
      <img src="{% thumbnail pub.thumbnail 300x0 detail %}" 
           alt="Thumbnail for: {{ pub.title }}"
           class="pub-thumbnail-image img-responsive">
    </a>
    {% if pub.award %}
    <img src="{% static 'website/img/awardoverlay.png' %}" 
         alt="" 
         aria-hidden="true"
         class="pub-award-banner">
    {% endif %}
  </div>
  
  <div class="pub-info">
    <!-- Title -->
    <a href="{{ pub.pdf_file.url }}">
      <!-- Making the titles h3s enables screen readers to find and present them more easily -->
      <h3 class="artifact-title pub-title">{{ pub.title }}</h3>
    </a>

    <!-- Authors -->
    <p class="pub-authors">
      {% for author in pub.authors.all %}
      <a href="{% url 'website:member_by_name' member_name=author.url_name %}">{{ author.get_full_name }}</a>{% if not forloop.last %},{% endif %}
      {% endfor %}
    </p>
    
    <!-- Venue, acceptance rate, and award -->
    <p class="pub-stats">
      <span class="pub-venue">
        {{ pub.get_formatted_forum_name }}
        {% if pub.to_appear %}
        <span class="pub-to-appear-text">To Appear</span>
        {% endif %}
      </span>
      {% if pub.total_papers_accepted %}
      <span class="pub-acceptance-rate">
        | 
        <span class="pub-acceptance-rate-text">
          Acceptance Rate: {{ pub.get_acceptance_rate|stringformat:'.1f' }}% ({{ pub.total_papers_accepted }} / {{ pub.total_papers_submitted }})
        </span>
      </span>
      {% endif %}
      {% if pub.award %}
      <span class="pub-award">
        | 
        {% if pub.is_best_paper %}
        <span class="pub-award-icon">
          <img src="{% static 'website/img/bestpaper.png' %}" 
               alt="Best Paper Award" 
               class="award-icon">
        </span>
        {% elif pub.is_honorable_mention %}
        <span class="pub-award-icon">
          <img src="{% static 'website/img/honorablemention.png' %}" 
               alt="Honorable Mention Award" 
               class="award-icon">
        </span>
        {% endif %}
        <span class="pub-award-text">{{ pub.award }}</span>
      </span>
      {% endif %}
    </p>
    
    {% comment %}
    <!-- I am removing keywords from layout as of v2.0.1 to help with
         access checks and reduce visual noise -->
    <!-- Keywords (hidden on extra-small screens) -->
    {% if pub.keywords and pub.keywords.count > 0 %}
    <p class="pub-keywords hidden-xs">
      <span class="pub-keywords-label">Keywords:</span>
      <span class="pub-keyword">
        {% for keyword in pub.keywords.all %}
        {{ keyword.keyword }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      </span>
    </p>
    {% endif %}
    {% endcomment %}

    <!-- Download links -->
    {% if pub.pdf_file %}
    <p class="pub-download-links">
      <a href="{{ pub.pdf_file.url }}" aria-label="Download PDF of {{ pub.title }}">
        <i class="fa-solid fa-file-pdf" aria-hidden="true"></i>PDF
      </a>
      {% if pub.arxiv_url %}
      <a href="{{ pub.arxiv_url }}" aria-label="View on arXiv">
        <i class="ai ai-arxiv" aria-hidden="true"></i>arXiv
      </a>
      {% endif %}
      {% if pub.official_url %}
      <a href="{{ pub.official_url }}" aria-label="View DOI record for {{ pub.title }}">
        <i class="ai ai-doi" aria-hidden="true"></i>doi
      </a>
      {% endif %}
      {% include 'snippets/display_citation_link_snippet.html' %}
      {% if pub.code_repo_url %}
      <a href="{{ pub.code_repo_url }}" aria-label="View code repository">
        <i class="fa-brands fa-github" aria-hidden="true"></i>Code
      </a>
      {% endif %}
      {% if pub.talk and pub.talk.pdf_file %}
      <a href="{{ pub.talk.pdf_file.url }}" aria-label="Download talk slides">
        <i class="fa-solid fa-person-chalkboard" aria-hidden="true"></i>Talk
      </a>
      {% endif %}
      {% if pub.poster and pub.poster.pdf_file %}
      <a href="{{ pub.poster.pdf_file.url }}" aria-label="Download poster">
        <i class="fa-solid fa-image" aria-hidden="true"></i>Poster
      </a>
      {% endif %}
      {% for project in pub.projects.all %}
      {% if project.can_show_online %}
      <a href="{% url 'website:project' project.short_name %}" aria-label="View project: {{ project.name }}">
        <i class="fa-solid fa-flask" aria-hidden="true"></i>{{ project.name }}
      </a>
      {% endif %}
      {% endfor %}
    </p>
    {% endif %}
    
  </div>
</article>

{% endif %}